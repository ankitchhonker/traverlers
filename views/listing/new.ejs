<% layout("layouts/boilerplate")%>
<style>
    .Gen-AI{
        height: 30px;
        border-radius: 5px;
        margin-left: 80%;
        margin-top: 6px;
        color: white;
        border: none;
        background-color: #FE424D;
        padding: 0 10px;
    }
</style>
<body>
    <form action="/listings" method="POST" novalidate class="needs-validation" enctype="multipart/form-data">

        <div>

             <label for="title"><b>Title</b></label>
            <input type="text" name="listing[title]" placeholder="Enter Title" id="title" class="form-control" required>
            <div class="invalid-feedback">please fill this title</div>

        </div>
     
        

        

        <div>
            <label for="image"> <b>Upload Image</b></label>
             <input type="file" name="listing[image]" id="image" class="form-control" >
             <div class="invalid-feedback">please choose the file image</div>

        </div>

        <div>
            <label for="category"><b>Choose category</b></label>
            <select name="listing[category]" id="category" class="form-control" required>
                <option value="Beachfront">Beachfront</option>
                <option value="Lakefronts">Lakefronts</option>
                <option value="trending">trending</option>
                <option value="Mountains">Mountains</option>
                <option value="Treehouse">Tree house</option>
                <option value="Cabin">Cabin</option>
                <option value="Desert"> Desert </option>
                <option value="Cottage">Cottage</option>
                <option value="Historicalhomes">Historicalhomes</option>
                <option value="Beach">Beach</option>
                <option value="Rooms">Rooms</option>
            </select>
        </div>

        <div>
            <label for="Enter price"><b>Price</b></label>
            <input type="text" name="listing[price]" placeholder="Enter price" id="price" class="form-control" required>
            <div class="invalid-feedback">please enter the price</div>
        </div> 

        <div>
            <label for="location"><b>Location</b></label>
            <input type="text" name="listing[location]" placeholder="Enter Location"  id="location" class="form-control" required>
            <div class="invalid-feedback">please enter the current location</div>
        </div>

        <div>
  <label for="latitude"><b>Latitude</b></label>
  <input type="text" name="listing[geometry][lat]" id="latitude" class="form-control" required>
     </div>

<div>
  <label for="longitude"><b>Longitude</b></label>
  <input type="text" name="listing[geometry][lng]" id="longitude" class="form-control" required>
</div>

<button type="button" onclick="getCurrentLocation()" class="btn btn-primary mt-2 Gen-AI">
  üìç Use Current Location
</button>


        <div>

            <label for="country"><b>Country</b></label>
            <input type="text" name="listing[country]" placeholder="Enter country" id="country" class="form-control" required>
            <div class="invalid-feedback">please enter the country</div>

        </div>

        <div>
            <label for="description"><b>Description</b></label>
            <textarea name="listing[description]" placeholder="Enter some description.." id="description" class="form-control"></textarea> 
            <div class="invalid-feedback">please write the short description </div>
            <button type="button" class="Gen-AI" onclick="generateAI()">‚ú® Generate Description</button>
        </div>
    
      
         <button class="submit" type="submit">Add</button>
    </form>
    
</body>
 <script>

async function getCurrentLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition((pos) => {
      document.getElementById("latitude").value = pos.coords.latitude;
      document.getElementById("longitude").value = pos.coords.longitude;
    }, (err) => {
      alert("Error fetching location: " + err.message);
    });
  } else {
    alert("Geolocation is not supported by your browser.");
  }
}
    async function generateAI() {
         

    const title = document.getElementById("title").value;
    const location = document.getElementById("location").value;
    const country = document.getElementById("country").value;
    const category = document.getElementById("category").value;
    const price = document.getElementById("price").value;
    const description = document.getElementById("description");
    description.value = "‚è≥ Generating description..."; // temporary

    const res = await fetch("/generate-description", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, location, country, category, price })
    });

    const data = await res.json();
     
    if (data.description) {
        description.value = data.description;
    } else {
        description.value = "‚ö†Ô∏è Could not generate description";
    }
}
 </script>